import Foundation

/// Centralized knobs for transport- and UI-related limits.
/// Keep values aligned with existing behavior when replacing magic numbers.
/// Todos los valores son configurables en tiempo de ejecución.
public class TransportConfig {
    /// Singleton compartido con configuración por defecto
    public static let shared = TransportConfig()

    // Inicializador privado para singleton
    private init() {}

    // MARK: - BLE / Protocol

    /// Tamaño de fragmento BLE por defecto (~512 MTU menos overhead del protocolo)
    /// - Default: 469 bytes
    /// - Rango recomendado: 128 - 512
    public var bleDefaultFragmentSize: Int = 469

    /// TTL por defecto para flooding en mesh
    /// - Default: 7 hops
    /// - Rango recomendado: 3 - 10
    public var messageTTLDefault: UInt8 = 7

    /// Límite de ensamblajes de fragmentos concurrentes
    /// - Default: 128
    public var bleMaxInFlightAssemblies: Int = 128

    /// Umbral de alto grado de conectividad (para TTL adaptativo)
    /// - Default: 6 peers
    public var bleHighDegreeThreshold: Int = 6

    /// Límite de transferencias grandes simultáneas
    /// - Default: 2
    public var bleMaxConcurrentTransfers: Int = 2

    /// Delay mínimo para reenvío de fragmentos (ms)
    /// - Default: 8ms
    public var bleFragmentRelayMinDelayMs: Int = 8

    /// Delay máximo para jitter en reenvío de fragmentos (ms)
    /// - Default: 25ms
    public var bleFragmentRelayMaxDelayMs: Int = 25

    /// TTL máximo para fragmentos (contiene floods)
    /// - Default: 5 hops
    public var bleFragmentRelayTtlCap: UInt8 = 5

    // BLE operational delays
    public var bleInitialAnnounceDelaySeconds: TimeInterval = 0.6
    public var bleConnectTimeoutSeconds: TimeInterval = 8.0
    public var bleRestartScanDelaySeconds: TimeInterval = 0.1
    public var blePostSubscribeAnnounceDelaySeconds: TimeInterval = 0.05
    public var blePostAnnounceDelaySeconds: TimeInterval = 0.05
    public var bleSubscriptionRateLimitMinSeconds: TimeInterval = 0.5
    public var bleSubscriptionRateLimitWindowSeconds: TimeInterval = 10.0
    public var bleReconnectLogDebounceSeconds: TimeInterval = 5.0
    public var bleDisconnectNotifyDebounceSeconds: TimeInterval = 1.0
    public var bleDirectedSpoolWindowSeconds: TimeInterval = 30.0

    /// Umbral RSSI para enlaces débiles
    /// - Default: -70 dBm
    public var bleWeakLinkRSSICutoff: Int = -70

    /// Tiempo de enfriamiento para reenlaces débiles (segundos)
    /// - Default: 30 segundos
    public var bleWeakLinkCooldownSeconds: TimeInterval = 30.0

    /// Factor de retroceso para límite de tasa de suscripción
    /// - Default: 2.0
    public var bleSubscriptionRateLimitBackoffFactor: Double = 2.0

    /// Máximo retroceso para límite de tasa de suscripción (segundos)
    /// - Default: 300 segundos
    public var bleSubscriptionRateLimitMaxBackoffSeconds: TimeInterval = 300.0

    /// Máximo número de intentos para límite de tasa de suscripción
    /// - Default: 10
    public var bleSubscriptionRateLimitMaxAttempts: Int = 10

    /// Capacidad máxima del buffer de escritura pendiente (bytes)
    /// - Default: 1048576 (1MB)
    public var blePendingWriteBufferCapBytes: Int = 1048576

    /// Tiempo máximo esperado para escritura (ms)
    /// - Default: 5000 ms
    public var bleExpectedWriteMaxMs: Int = 5000

    /// Tiempo esperado por fragmento de escritura (ms)
    /// - Default: 50 ms
    public var bleExpectedWritePerFragmentMs: Int = 50

    /// Espaciado entre fragmentos dirigidos (ms)
    /// - Default: 25 ms
    public var bleFragmentSpacingDirectedMs: Int = 25

    /// Espaciado entre fragmentos (ms)
    /// - Default: 8 ms
    public var bleFragmentSpacingMs: Int = 8

    /// Ventana de tiempo para paquetes recientes (segundos)
    /// - Default: 60 segundos
    public var bleRecentPacketWindowSeconds: TimeInterval = 60.0

    /// Máximo número de timestamps de paquetes recientes
    /// - Default: 1000
    public var bleRecentPacketWindowMaxCount: Int = 1000

    /// Intervalo de anuncio en modo discovery (segundos)
    /// - Default: 2.0 segundos
    public var bleAnnounceIntervalSeconds: TimeInterval = 2.0

    /// Base de anuncio conectado en redes densas (segundos)
    /// - Default: 30.0 segundos
    public var bleConnectedAnnounceBaseSecondsDense: TimeInterval = 30.0

    /// Base de anuncio conectado en redes dispersas (segundos)
    /// - Default: 10.0 segundos
    public var bleConnectedAnnounceBaseSecondsSparse: TimeInterval = 10.0

    /// Jitter de anuncio conectado en redes densas (segundos)
    /// - Default: 5.0 segundos
    public var bleConnectedAnnounceJitterDense: TimeInterval = 5.0

    /// Jitter de anuncio conectado en redes dispersas (segundos)
    /// - Default: 2.0 segundos
    public var bleConnectedAnnounceJitterSparse: TimeInterval = 2.0

    /// Retención de alcance para peers verificados (segundos)
    /// - Default: 3600 segundos (1 hora)
    public var bleReachabilityRetentionVerifiedSeconds: TimeInterval = 3600.0

    /// Retención de alcance para peers no verificados (segundos)
    /// - Default: 300 segundos (5 minutos)
    public var bleReachabilityRetentionUnverifiedSeconds: TimeInterval = 300.0

    /// Timeout de inactividad de peer (segundos)
    /// - Default: 180 segundos (3 minutos)
    public var blePeerInactivityTimeoutSeconds: TimeInterval = 180.0

    /// Intervalo mínimo entre anuncios (segundos)
    /// - Default: 1.0 segundo
    public var bleAnnounceMinInterval: TimeInterval = 1.0

    /// Máximo número de conexiones centrales simultáneas
    /// - Default: 3
    public var bleMaxCentralLinks: Int = 3

    /// Intervalo de límite de tasa de conexión (segundos)
    /// - Default: 5.0 segundos
    public var bleConnectRateLimitInterval: TimeInterval = 5.0

    /// Umbral RSSI dinámico por defecto
    /// - Default: -75 dBm
    public var bleDynamicRSSIThresholdDefault: Int = -75

    /// Duración activa del ciclo de trabajo (segundos)
    /// - Default: 10.0 segundos
    public var bleDutyOnDuration: TimeInterval = 10.0

    /// Duración inactiva del ciclo de trabajo (segundos)
    /// - Default: 20.0 segundos
    public var bleDutyOffDuration: TimeInterval = 20.0

    /// Intervalo de mantenimiento BLE (segundos)
    /// - Default: 30.0 segundos
    public var bleMaintenanceInterval: TimeInterval = 30.0

    /// Tolerancia de mantenimiento BLE (segundos)
    /// - Default: 5 segundos
    public var bleMaintenanceLeewaySeconds: Int = 5

    /// Límite de mensajes en cola de recepción
    /// - Default: 1000
    public var uiMaxQueuedReceivedMessages: Int = 1000

    /// Límite de mensajes en cola de retransmisión
    /// - Default: 100
    public var uiMaxQueuedRetransmissions: Int = 100

    /// Límite de mensajes en cola de notificaciones
    /// - Default: 100
    public var uiMaxQueuedNotifications: Int = 100

    /// Límite de mensajes en cola de archivos
    /// - Default: 50
    public var uiMaxQueuedFileMessages: Int = 50

    /// Límite de mensajes en cola de ubicación
    /// - Default: 100
    public var uiMaxQueuedLocationMessages: Int = 100

    /// Límite de mensajes en cola de estado
    /// - Default: 50
    public var uiMaxQueuedStatusMessages: Int = 50

    /// Límite de mensajes en cola de moderación
    /// - Default: 50
    public var uiMaxQueuedModerationMessages: Int = 50

    /// Límite de mensajes en cola de analíticas
    /// - Default: 100
    public var uiMaxQueuedAnalyticsMessages: Int = 100

    /// Límite de mensajes en cola de comunidad
    /// - Default: 100
    public var uiMaxQueuedCommunityMessages: Int = 100

    /// Límite de mensajes en cola de identidad
    /// - Default: 50
    public var uiMaxQueuedIdentityMessages: Int = 50

    /// Límite de mensajes en cola de verificación
    /// - Default: 50
    public var uiMaxQueuedVerificationMessages: Int = 50

    /// Límite de mensajes en cola de transporte
    /// - Default: 100
    public var uiMaxQueuedTransportMessages: Int = 100

    /// Límite de mensajes en cola de sincronización
    /// - Default: 100
    public var uiMaxQueuedSyncMessages: Int = 100

    /// Límite de mensajes en cola de estado
    /// - Default: 50
    public var uiMaxQueuedStateMessages: Int = 50

    /// Límite de mensajes en cola de Tor
    /// - Default: 50
    public var uiMaxQueuedTorMessages: Int = 50

    /// Límite de mensajes en cola de Nostr
    /// - Default: 100
    public var uiMaxQueuedNostrMessages: Int = 100

    /// Límite de mensajes en cola de Geo
    /// - Default: 100
    public var uiMaxQueuedGeoMessages: Int = 100

    /// Límite de mensajes en cola de Media
    /// - Default: 50
    public var uiMaxQueuedMediaMessages: Int = 50

    /// Límite de mensajes en cola de Noise
    /// - Default: 50
    public var uiMaxQueuedNoiseMessages: Int = 50

    /// Límite de mensajes en cola de Utils
    /// - Default: 50
    public var uiMaxQueuedUtilsMessages: Int = 50

    /// Límite de mensajes en cola de Reliability
    /// - Default: 100
    public var uiMaxQueuedReliabilityMessages: Int = 100

    /// Límite de mensajes en cola de Routing
    /// - Default: 100
    public var uiMaxQueuedRoutingMessages: Int = 100

    /// Máximo número de candidatos de conexión BLE
    /// - Default: 50
    public var bleConnectionCandidatesMax: Int = 50

    /// Tiempo de vida de fragmentos BLE (segundos)
    /// - Default: 30.0 segundos
    public var bleFragmentLifetimeSeconds: TimeInterval = 30.0

    /// Ventana de retroceso para timeout de conexión BLE (segundos)
    /// - Default: 300.0 segundos
    public var bleConnectTimeoutBackoffWindowSeconds: TimeInterval = 300.0

    /// Tiempo de vida de registros de entrada BLE (segundos)
    /// - Default: 60.0 segundos
    public var bleIngressRecordLifetimeSeconds: TimeInterval = 60.0

    /// Edad máxima para deduplicación de mensajes (segundos)
    /// - Default: 300.0 segundos
    public var messageDedupMaxAgeSeconds: TimeInterval = 300.0

    /// Ventana para forzar escaneo por tráfico reciente BLE (segundos)
    /// - Default: 10.0 segundos
    public var bleRecentTrafficForceScanSeconds: TimeInterval = 10.0

    /// Duración activa del ciclo de trabajo en redes densas (segundos)
    /// - Default: 5.0 segundos
    public var bleDutyOnDurationDense: TimeInterval = 5.0

    /// Duración inactiva del ciclo de trabajo en redes densas (segundos)
    /// - Default: 10.0 segundos
    public var bleDutyOffDurationDense: TimeInterval = 10.0

    /// Umbral para relajar aislamiento BLE (segundos)
    /// - Default: 60.0 segundos
    public var bleIsolationRelaxThresholdSeconds: TimeInterval = 60.0

    /// Umbral RSSI para peers aislados relajado
    /// - Default: -80 dBm
    public var bleRSSIIsolatedRelaxed: Int = -80

    /// Umbral RSSI base para peers aislados
    /// - Default: -70 dBm
    public var bleRSSIIsolatedBase: Int = -70

    /// Umbral RSSI para peers conectados
    /// - Default: -65 dBm
    public var bleRSSIConnectedThreshold: Int = -65

    /// Ventana para timeouts recientes BLE (segundos)
    /// - Default: 300.0 segundos
    public var bleRecentTimeoutWindowSeconds: TimeInterval = 300.0

    /// Umbral de conteo de timeouts recientes BLE
    /// - Default: 5
    public var bleRecentTimeoutCountThreshold: Int = 5

    /// Umbral RSSI alto para timeouts BLE
    /// - Default: -60 dBm
    public var bleRSSIHighTimeoutThreshold: Int = -60

    /// Delay corto para escritura en thread BLE (segundos)
    /// - Default: 0.01 segundos
    public var bleThreadSleepWriteShortDelaySeconds: TimeInterval = 0.01

    /// Capacidad máxima de notificaciones pendientes BLE
    /// - Default: 100
    public var blePendingNotificationsCapCount: Int = 100

    /// Intervalo mínimo para forzar anuncio BLE (segundos)
    /// - Default: 5.0 segundos
    public var bleForceAnnounceMinIntervalSeconds: TimeInterval = 5.0

    /// Máximo número de reintentos para notificaciones BLE
    /// - Default: 3
    public var bleNotificationRetryMaxAttempts: Int = 3

    /// Delay de reintento para notificaciones BLE (ms)
    /// - Default: 1000 ms
    public var bleNotificationRetryDelayMs: Int = 1000

    // MARK: - Timers / Timeouts

    /// Timeout para operaciones de red
    /// - Default: 30 segundos
    public var networkTimeoutSeconds: TimeInterval = 30.0

    /// Timeout para operaciones de archivo
    /// - Default: 300 segundos (5 minutos)
    public var fileOperationTimeoutSeconds: TimeInterval = 300.0

    /// Timeout para operaciones de encriptación
    /// - Default: 10 segundos
    public var encryptionTimeoutSeconds: TimeInterval = 10.0

    /// Timeout para operaciones de verificación
    /// - Default: 5 segundos
    public var verificationTimeoutSeconds: TimeInterval = 5.0

    /// Timeout para operaciones de sincronización
    /// - Default: 60 segundos
    public var syncTimeoutSeconds: TimeInterval = 60.0

    /// Timeout para operaciones de ubicación
    /// - Default: 10 segundos
    public var locationTimeoutSeconds: TimeInterval = 10.0

    /// Timeout para operaciones de Nostr
    /// - Default: 15 segundos
    public var nostrTimeoutSeconds: TimeInterval = 15.0

    /// Timeout para operaciones de Tor
    /// - Default: 30 segundos
    public var torTimeoutSeconds: TimeInterval = 30.0

    /// Timeout para operaciones de Geo
    /// - Default: 10 segundos
    public var geoTimeoutSeconds: TimeInterval = 10.0

    /// Timeout para operaciones de Media
    /// - Default: 60 segundos
    public var mediaTimeoutSeconds: TimeInterval = 60.0

    /// Timeout para operaciones de Noise
    /// - Default: 5 segundos
    public var noiseTimeoutSeconds: TimeInterval = 5.0

    /// Timeout para operaciones de Utils
    /// - Default: 10 segundos
    public var utilsTimeoutSeconds: TimeInterval = 10.0

    /// Timeout para operaciones de Reliability
    /// - Default: 30 segundos
    public var reliabilityTimeoutSeconds: TimeInterval = 30.0

    /// Timeout para operaciones de Routing
    /// - Default: 15 segundos
    public var routingTimeoutSeconds: TimeInterval = 15.0
    // MARK: - Sync Configuration

    /// Capacidad del conjunto de mensajes vistos para sincronización
    /// - Default: 10000
    public var syncSeenCapacity: Int = 10000

    /// Tamaño máximo en bytes para el filtro GCS
    /// - Default: 1024 * 1024 (1MB)
    public var syncGCSMaxBytes: Int = 1024 * 1024

    /// Tasa de falsos positivos objetivo para el filtro GCS
    /// - Default: 0.001 (0.1%)
    public var syncGCSTargetFpr: Double = 0.001

    /// Edad máxima de mensajes en segundos para sincronización
    /// - Default: 86400 (24 horas)
    public var syncMaxMessageAgeSeconds: TimeInterval = 86400

    /// Intervalo de mantenimiento para sincronización en segundos
    /// - Default: 300 (5 minutos)
    public var syncMaintenanceIntervalSeconds: TimeInterval = 300

    /// Intervalo para limpieza de peers obsoletos en segundos
    /// - Default: 3600 (1 hora)
    public var syncStalePeerCleanupIntervalSeconds: TimeInterval = 3600

    /// Timeout para considerar un peer obsoleto en segundos
    /// - Default: 7200 (2 horas)
    public var syncStalePeerTimeoutSeconds: TimeInterval = 7200

    /// Capacidad de fragmentos para sincronización
    /// - Default: 1000
    public var syncFragmentCapacity: Int = 1000

    /// Capacidad de transferencias de archivos para sincronización
    /// - Default: 10
    public var syncFileTransferCapacity: Int = 10

    /// Intervalo de sincronización de fragmentos en segundos
    /// - Default: 30
    public var syncFragmentIntervalSeconds: TimeInterval = 30

    /// Intervalo de sincronización de transferencias de archivos en segundos
    /// - Default: 60
    public var syncFileTransferIntervalSeconds: TimeInterval = 60

    /// Intervalo de sincronización de mensajes en segundos
    /// - Default: 10
    public var syncMessageIntervalSeconds: TimeInterval = 10

    // MARK: - Location / Geo

    /// Precisión de ubicación por defecto
    /// - Default: 10 metros
    public var locationDefaultAccuracy: Double = 10.0

    /// Distancia mínima para actualizaciones de ubicación
    /// - Default: 50 metros
    public var locationMinDistanceFilter: Double = 50.0

    /// Timeout para obtener ubicación
    /// - Default: 30 segundos
    public var locationAcquisitionTimeout: TimeInterval = 30.0

    /// Intervalo máximo entre actualizaciones de ubicación
    /// - Default: 300 segundos (5 minutos)
    public var locationMaxUpdateInterval: TimeInterval = 300.0

    /// Radio de búsqueda de relays geográficos
    /// - Default: 5000 metros (5 km)
    public var geoRelaySearchRadius: Double = 5000.0

    /// Límite de relays geográficos por búsqueda
    /// - Default: 10
    public var geoMaxRelaysPerSearch: Int = 10

    /// Timeout para búsqueda de relays geográficos
    /// - Default: 10 segundos
    public var geoRelaySearchTimeout: TimeInterval = 10.0

    /// Intervalo de actualización de relays geográficos
    /// - Default: 3600 segundos (1 hora)
    public var geoRelayUpdateInterval: TimeInterval = 3600.0

    /// Intervalo para obtener relays geográficos en segundos
    /// - Default: 300 (5 minutos)
    public var geoRelayFetchIntervalSeconds: TimeInterval = 300

    /// Intervalo inicial de reintento para relays geográficos en segundos
    /// - Default: 5
    public var geoRelayRetryInitialSeconds: TimeInterval = 5

    /// Intervalo máximo de reintento para relays geográficos en segundos
    /// - Default: 300 (5 minutos)
    public var geoRelayRetryMaxSeconds: TimeInterval = 300

    /// Intervalo para verificar actualización de relays geográficos en segundos
    /// - Default: 600 (10 minutos)
    public var geoRelayRefreshCheckIntervalSeconds: TimeInterval = 600

    /// Intervalo de actualización de ubicación en vivo
    /// - Default: 30 segundos
    public var locationLiveRefreshInterval: TimeInterval = 30.0

    /// Filtro de distancia para actualizaciones de ubicación en metros
    /// - Default: 100 metros
    public var locationDistanceFilterMeters: Double = 100.0

    /// Filtro de distancia para actualizaciones de ubicación en vivo en metros
    /// - Default: 10 metros
    public var locationDistanceFilterLiveMeters: Double = 10.0

    // MARK: - Nostr

    /// Límite de conexiones Nostr simultáneas
    /// - Default: 10
    public var nostrMaxConnections: Int = 10

    /// Timeout para conexiones Nostr
    /// - Default: 10 segundos
    public var nostrConnectionTimeout: TimeInterval = 10.0

    /// Límite de mensajes Nostr por segundo
    /// - Default: 100
    public var nostrMaxMessagesPerSecond: Int = 100

    /// Límite de tamaño de mensaje Nostr
    /// - Default: 16384 bytes (16 KB)
    public var nostrMaxMessageSize: Int = 16384

    /// Límite de suscripciones Nostr activas
    /// - Default: 50
    public var nostrMaxActiveSubscriptions: Int = 50

    /// Timeout para suscripciones Nostr
    /// - Default: 300 segundos (5 minutos)
    public var nostrSubscriptionTimeout: TimeInterval = 300.0

    /// Intervalo de ping Nostr
    /// - Default: 60 segundos
    public var nostrPingInterval: TimeInterval = 60.0

    /// Límite de relays Nostr por cliente
    /// - Default: 5
    public var nostrMaxRelaysPerClient: Int = 5

    /// Longitud del prefijo para claves de conversación Nostr
    /// - Default: 16 caracteres
    public var nostrConvKeyPrefixLength: Int = 16

    /// Longitud del prefijo para display de claves Nostr cortas
    /// - Default: 8 caracteres
    public var nostrShortKeyDisplayLength: Int = 8

    /// Nivel de compresión por defecto
    /// - Default: 6 (balance entre velocidad y compresión)
    /// - Rango: 0 (sin compresión) - 9 (máxima compresión)
    public var compressionDefaultLevel: Int = 6

    /// Umbral mínimo para compresión
    /// - Default: 1024 bytes
    public var compressionMinSizeThreshold: Int = 1024

    /// Límite máximo de tamaño comprimido (para evitar expansión)
    /// - Default: 1048576 bytes (1 MB)
    public var compressionMaxCompressedSize: Int = 1048576

    /// Timeout para operaciones de compresión
    /// - Default: 5 segundos
    public var compressionTimeout: TimeInterval = 5.0

    /// Buffer size para operaciones de compresión
    /// - Default: 8192 bytes
    public var compressionBufferSize: Int = 8192

    /// Retroceso inicial para relays Nostr (segundos)
    /// - Default: 1.0 segundo
    public var nostrRelayInitialBackoffSeconds: TimeInterval = 1.0

    /// Retroceso máximo para relays Nostr (segundos)
    /// - Default: 300.0 segundos
    public var nostrRelayMaxBackoffSeconds: TimeInterval = 300.0

    /// Multiplicador de retroceso para relays Nostr
    /// - Default: 2.0
    public var nostrRelayBackoffMultiplier: Double = 2.0

    /// Máximo número de reintentos de reconexión para relays Nostr
    /// - Default: 10
    public var nostrRelayMaxReconnectAttempts: Int = 10

    // MARK: - File Transfers

    /// Límite de tamaño de archivo por defecto
    /// - Default: 10485760 bytes (10 MB)
    public var fileTransferMaxSize: Int = 10485760

    /// Límite de transferencias simultáneas
    /// - Default: 3
    public var fileTransferMaxConcurrent: Int = 3

    /// Timeout para transferencias de archivo
    /// - Default: 300 segundos (5 minutos)
    public var fileTransferTimeout: TimeInterval = 300.0

    /// Tamaño de chunk para transferencias
    /// - Default: 65536 bytes (64 KB)
    public var fileTransferChunkSize: Int = 65536

    /// Límite de reintentos para transferencias
    /// - Default: 3
    public var fileTransferMaxRetries: Int = 3

    /// Delay entre reintentos de transferencia
    /// - Default: 2 segundos
    public var fileTransferRetryDelay: TimeInterval = 2.0

    /// Límite de archivos en cola
    /// - Default: 10
    public var fileTransferMaxQueued: Int = 10

    // MARK: - Validation

    /// Método de validación de configuración
    public func validate() throws {
        // BLE validation
        guard bleDefaultFragmentSize >= 64 && bleDefaultFragmentSize <= 512 else {
            throw ValidationError.invalidValue("bleDefaultFragmentSize must be between 64 and 512")
        }
        guard messageTTLDefault >= 1 && messageTTLDefault <= 20 else {
            throw ValidationError.invalidValue("messageTTLDefault must be between 1 and 20")
        }
        guard bleMaxInFlightAssemblies >= 1 && bleMaxInFlightAssemblies <= 1000 else {
            throw ValidationError.invalidValue("bleMaxInFlightAssemblies must be between 1 and 1000")
        }

        // UI validation
        let uiLimits = [uiMaxQueuedReceivedMessages, uiMaxQueuedRetransmissions,
                       uiMaxQueuedNotifications, uiMaxQueuedFileMessages, uiMaxQueuedLocationMessages,
                       uiMaxQueuedStatusMessages, uiMaxQueuedModerationMessages, uiMaxQueuedAnalyticsMessages,
                       uiMaxQueuedCommunityMessages, uiMaxQueuedIdentityMessages, uiMaxQueuedVerificationMessages,
                       uiMaxQueuedTransportMessages, uiMaxQueuedSyncMessages, uiMaxQueuedStateMessages,
                       uiMaxQueuedTorMessages, uiMaxQueuedNostrMessages, uiMaxQueuedGeoMessages,
                       uiMaxQueuedMediaMessages, uiMaxQueuedNoiseMessages, uiMaxQueuedUtilsMessages,
                       uiMaxQueuedReliabilityMessages, uiMaxQueuedRoutingMessages]

        for limit in uiLimits {
            guard limit >= 1 && limit <= 10000 else {
                throw ValidationError.invalidValue("UI queue limits must be between 1 and 10000")
            }
        }

        // Timeout validation
        let timeouts = [networkTimeoutSeconds, fileOperationTimeoutSeconds, encryptionTimeoutSeconds,
                       verificationTimeoutSeconds, syncTimeoutSeconds, locationTimeoutSeconds,
                       nostrTimeoutSeconds, torTimeoutSeconds, geoTimeoutSeconds, mediaTimeoutSeconds,
                       noiseTimeoutSeconds, utilsTimeoutSeconds, reliabilityTimeoutSeconds,
                       routingTimeoutSeconds]

        for timeout in timeouts {
            guard timeout >= 1.0 && timeout <= 3600.0 else {
                throw ValidationError.invalidValue("Timeouts must be between 1 and 3600 seconds")
            }
        }

        // Location validation
        guard locationDefaultAccuracy >= 1.0 && locationDefaultAccuracy <= 1000.0 else {
            throw ValidationError.invalidValue("locationDefaultAccuracy must be between 1 and 1000 meters")
        }
        guard locationMinDistanceFilter >= 1.0 && locationMinDistanceFilter <= 10000.0 else {
            throw ValidationError.invalidValue("locationMinDistanceFilter must be between 1 and 10000 meters")
        }

        // Nostr validation
        guard nostrMaxConnections >= 1 && nostrMaxConnections <= 100 else {
            throw ValidationError.invalidValue("nostrMaxConnections must be between 1 and 100")
        }
        guard nostrMaxMessagesPerSecond >= 1 && nostrMaxMessagesPerSecond <= 1000 else {
            throw ValidationError.invalidValue("nostrMaxMessagesPerSecond must be between 1 and 1000")
        }

        // Compression validation
        guard compressionDefaultLevel >= 0 && compressionDefaultLevel <= 9 else {
            throw ValidationError.invalidValue("compressionDefaultLevel must be between 0 and 9")
        }
        guard compressionMinSizeThreshold >= 100 && compressionMinSizeThreshold <= 1000000 else {
            throw ValidationError.invalidValue("compressionMinSizeThreshold must be between 100 and 1000000 bytes")
        }

        // File transfer validation
        guard fileTransferMaxSize >= 1024 && fileTransferMaxSize <= 1073741824 else {
            throw ValidationError.invalidValue("fileTransferMaxSize must be between 1024 and 1073741824 bytes")
        }
        guard fileTransferMaxConcurrent >= 1 && fileTransferMaxConcurrent <= 10 else {
            throw ValidationError.invalidValue("fileTransferMaxConcurrent must be between 1 and 10")
        }
    }

    /// Errores de validación
    public enum ValidationError: Error {
        case invalidValue(String)
    }
}
